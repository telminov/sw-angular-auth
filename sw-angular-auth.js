(function() {
  angular.module('swAuth').provider('authConfigProvider', function() {
    var config;
    config = {
      systemLabel: 'System Label',
      serverAddress: '/server_url',
      serverLoginUrl: '/login/',
      serverLogoutUrl: '/logout/',
      serverUserInfoUrl: '/current_user/',
      serverCSRFUrl: '/get_csrf/',
      appLoginUrl: '/login/'
    };
    return {
      $get: function() {
        return {
          getSystemLabel: function() {
            return config.systemLabel;
          },
          getServerAddress: function() {
            return config.serverAddress;
          },
          getServerLoginUrl: function() {
            return config.serverLoginUrl;
          },
          getServerLogoutUrl: function() {
            return config.serverLogoutUrl;
          },
          getServerUserInfoUrl: function() {
            return config.serverUserInfoUrl;
          },
          getServerCSRFUrl: function() {
            return config.serverCSRFUrl;
          },
          getAppLoginUrl: function() {
            return config.appLoginUrl;
          }
        };
      },
      setSystemLabel: function(label) {
        return config.systemLabel = label;
      },
      setServerAddress: function(address) {
        return config.serverAddress = address;
      },
      setServerLoginUrl: function(url) {
        return config.serverLoginUrl = url;
      },
      setServerLogoutUrl: function(url) {
        return config.serverLogoutUrl = url;
      },
      setServerUserInfoUrl: function(url) {
        return config.serverUserInfoUrl = url;
      },
      setServerCSRFUrl: function(url) {
        return config.serverCSRFUrl = url;
      },
      setAppLoginUrl: function(url) {
        return config.appLoginUrl = url;
      }
    };
  });

}).call(this);

(function() {
  angular.module('swAuth', ['ngCookies', 'ngRoute']).constant('AUTH_UPDATE_USER', 'sw_auth_service_update_user').constant('AUTH_SERVER_REJECT', 'sw_auth_service_server_401_or_403_reject').config(function($httpProvider) {
    return $httpProvider.responseInterceptors.push('securityInterceptor');
  }).provider('securityInterceptor', function() {
    return {
      $get: function($location, $q, $rootScope, AUTH_SERVER_REJECT) {
        return function(promise) {
          return promise.then(null, function(response) {
            if (response.status === 401 || response.status === 403) {
              $rootScope.$broadcast(AUTH_SERVER_REJECT, response.status, response.data);
            }
            return $q.reject(response);
          });
        };
      }
    };
  }).run(function($rootScope, $location, auth, AUTH_UPDATE_USER, AUTH_SERVER_REJECT) {
    $rootScope.$on('$routeChangeStart', function(scope, next, current) {
      var loginUrl, nextPath, ref;
      nextPath = '';
      if (next != null ? (ref = next.$$route) != null ? ref.originalPath : void 0 : void 0) {
        nextPath = next.$$route.originalPath;
      }
      if (!auth.isAuthenticated()) {
        loginUrl = auth.getLoginUrl();
        if (loginUrl === nextPath) {
          return;
        }
        return $location.path(loginUrl);
      }
    });
    return $rootScope.$on(AUTH_SERVER_REJECT, function(event, server_status) {
      auth.clearCurrentUser();
      return $location.path(auth.getLoginUrl());
    });
  });

}).call(this);

(function() {
  angular.module('swAuth').service('auth', function($http, $rootScope, $cookieStore, authConfig, AUTH_UPDATE_USER) {
    var auth;
    auth = this;
    auth.getUser = function() {
      return $cookieStore.get('user');
    };
    auth.setUser = function(newUserData) {
      var oldUserData;
      oldUserData = auth.getUser();
      $cookieStore.put('user', newUserData);
      return $rootScope.$broadcast(AUTH_UPDATE_USER, newUserData, oldUserData);
    };
    auth.isAuthenticated = function(userData) {
      var user;
      user = userData || auth.getUser();
      return (user != null ? user.isAuthenticated : void 0) || false;
    };
    auth.getName = function(userData) {
      var user;
      user = userData || auth.getUser();
      return user != null ? user.username : void 0;
    };
    auth.getLoginUrl = function() {
      return authConfig.getAppLoginUrl();
    };
    auth.getCSRF = function() {
      var csrfUrl;
      csrfUrl = authConfig.getServerCSRFUrl();
      return $http.get(csrfUrl).then(function(response) {
        return response.data;
      });
    };
    auth.login = function(username, password, makePostSubmit) {
      var csrfPromise, loginPromise;
      csrfPromise = auth.getCSRF();
      loginPromise = csrfPromise.then(function(csrf) {
        var loginUrl;
        loginUrl = authConfig.getServerLoginUrl();
        return loginPromise = $http({
          method: "POST",
          url: loginUrl,
          data: {
            csrfmiddlewaretoken: csrf,
            username: username,
            password: password
          },
          withCredentials: true
        });
      });
      loginPromise = loginPromise.then(function() {
        var userPromise;
        userPromise = auth.getCurrentUser();
        if (makePostSubmit) {
          userPromise.then(function() {
            var form;
            form = $("<form method='POST' action='" + loginUrl + "'><input name='username'><input name='password'></form>");
            form.find('[name=username]').val(username);
            form.find('[name=password]').val(password);
            return form.submit();
          });
        }
        return userPromise;
      });
      return loginPromise;
    };
    auth.getCurrentUser = function() {
      var userPromise;
      userPromise = $http({
        method: "GET",
        url: authConfig.getServerUserInfoUrl(),
        withCredentials: true
      });
      userPromise = userPromise.then(function(response) {
        var newUserData;
        newUserData = response.data;
        auth.setUser(newUserData);
        return newUserData;
      });
      return userPromise;
    };
    auth.clearCurrentUser = function() {
      var newUserData;
      newUserData = {};
      return auth.setUser(newUserData);
    };
    auth.logout = function() {
      var logoutPromise;
      logoutPromise = $http({
        method: "POST",
        url: authConfig.getServerLogoutUrl(),
        withCredentials: true
      });
      logoutPromise.then(function() {
        return auth.clearCurrentUser();
      });
      return logoutPromise;
    };
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbmZpZy5jb2ZmZWUiLCJtYWluLmNvZmZlZSIsInNlcnZpY2VzLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLEVBQUEsT0FBTyxDQUFDLE1BQVIsQ0FBZSxRQUFmLENBQ0ksQ0FBQyxRQURMLENBQ2Msb0JBRGQsRUFDb0MsU0FBQSxHQUFBO0FBQzVCLFFBQUEsTUFBQTtBQUFBLElBQUEsTUFBQSxHQUFTO0FBQUEsTUFDTCxXQUFBLEVBQWEsY0FEUjtBQUFBLE1BRUwsYUFBQSxFQUFlLGFBRlY7QUFBQSxNQUdMLGNBQUEsRUFBZ0IsU0FIWDtBQUFBLE1BSUwsZUFBQSxFQUFpQixVQUpaO0FBQUEsTUFLTCxpQkFBQSxFQUFtQixnQkFMZDtBQUFBLE1BTUwsYUFBQSxFQUFlLFlBTlY7QUFBQSxNQU9MLFdBQUEsRUFBYSxTQVBSO0tBQVQsQ0FBQTtBQVVBLFdBQU87QUFBQSxNQUNILElBQUEsRUFBTSxTQUFBLEdBQUE7ZUFDRjtBQUFBLFVBQ0ksY0FBQSxFQUFnQixTQUFBLEdBQUE7bUJBQUcsTUFBTSxDQUFDLFlBQVY7VUFBQSxDQURwQjtBQUFBLFVBRUksZ0JBQUEsRUFBa0IsU0FBQSxHQUFBO21CQUFHLE1BQU0sQ0FBQyxjQUFWO1VBQUEsQ0FGdEI7QUFBQSxVQUdJLGlCQUFBLEVBQW1CLFNBQUEsR0FBQTttQkFBRyxNQUFNLENBQUMsZUFBVjtVQUFBLENBSHZCO0FBQUEsVUFJSSxrQkFBQSxFQUFvQixTQUFBLEdBQUE7bUJBQUcsTUFBTSxDQUFDLGdCQUFWO1VBQUEsQ0FKeEI7QUFBQSxVQUtJLG9CQUFBLEVBQXNCLFNBQUEsR0FBQTttQkFBRyxNQUFNLENBQUMsa0JBQVY7VUFBQSxDQUwxQjtBQUFBLFVBTUksZ0JBQUEsRUFBa0IsU0FBQSxHQUFBO21CQUFHLE1BQU0sQ0FBQyxjQUFWO1VBQUEsQ0FOdEI7QUFBQSxVQU9JLGNBQUEsRUFBZ0IsU0FBQSxHQUFBO21CQUFHLE1BQU0sQ0FBQyxZQUFWO1VBQUEsQ0FQcEI7VUFE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QUFpQixJQUZqQjtPQURVLENBQWQsQ0FBQTtBQUFBLE1BT0EsV0FBQSxHQUFjLFdBQVcsQ0FBQyxJQUFaLENBQWlCLFNBQUMsUUFBRCxHQUFBO0FBQzNCLFlBQUEsV0FBQTtBQUFBLFFBQUEsV0FBQSxHQUFjLFFBQVEsQ0FBQyxJQUF2QixDQUFBO0FBQUEsUUFDQSxJQUFJLENBQUMsT0FBTCxDQUFhLFdBQWIsQ0FEQSxDQUFBO0FBRUEsZUFBTyxXQUFQLENBSDJCO01BQUEsQ0FBakIsQ0FQZCxDQUFBO0FBWUEsYUFBTyxXQUFQLENBYmtCO0lBQUEsQ0EzRHRCLENBQUE7QUFBQSxJQTJFQSxJQUFJLENBQUMsZ0JBQUwsR0FBd0IsU0FBQSxHQUFBO0FBQ3BCLFVBQUEsV0FBQTtBQUFBLE1BQUEsV0FBQSxHQUFjLEVBQWQsQ0FBQTthQUNBLElBQUksQ0FBQyxPQUFMLENBQWEsV0FBYixFQUZvQjtJQUFBLENBM0V4QixDQUFBO0FBQUEsSUErRUEsSUFBSSxDQUFDLE1BQUwsR0FBYyxTQUFBLEdBQUE7QUFDVixVQUFBLGFBQUE7QUFBQSxNQUFBLGFBQUEsR0FBZ0IsS0FBQSxDQUNaO0FBQUEsUUFBQSxNQUFBLEVBQVEsTUFBUjtBQUFBLFFBQ0EsR0FBQSxFQUFLLFVBQVUsQ0FBQyxrQkFBWCxDQUFBLENBREw7QUFBQSxRQUVBLGVBQUEsRUFBaUIsSUFGakI7T0FEWSxDQUFoQixDQUFBO0FBQUEsTUFNQSxhQUFhLENBQUMsSUFBZCxDQUFtQixTQUFBLEdBQUE7ZUFDZixJQUFJLENBQUMsZ0JBQUwsQ0FBQSxFQURlO01BQUEsQ0FBbkIsQ0FOQSxDQUFBO0FBU0EsYUFBTyxhQUFQLENBVlU7SUFBQSxDQS9FZCxDQURhO0VBQUEsQ0FEckIsQ0FBQSxDQUFBO0FBQUEiLCJmaWxlIjoic3ctYW5ndWxhci1hdXRoLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ3N3QXV0aCcpXHJcbiAgICAucHJvdmlkZXIgJ2F1dGhDb25maWdQcm92aWRlcicsIC0+XHJcbiAgICAgICAgY29uZmlnID0ge1xyXG4gICAgICAgICAgICBzeXN0ZW1MYWJlbDogJ1N5c3RlbSBMYWJlbCdcclxuICAgICAgICAgICAgc2VydmVyQWRkcmVzczogJy9zZXJ2ZXJfdXJsJ1xyXG4gICAgICAgICAgICBzZXJ2ZXJMb2dpblVybDogJy9sb2dpbi8nXHJcbiAgICAgICAgICAgIHNlcnZlckxvZ291dFVybDogJy9sb2dvdXQvJ1xyXG4gICAgICAgICAgICBzZXJ2ZXJVc2VySW5mb1VybDogJy9jdXJyZW50X3VzZXIvJ1xyXG4gICAgICAgICAgICBzZXJ2ZXJDU1JGVXJsOiAnL2dldF9jc3JmLydcclxuICAgICAgICAgICAgYXBwTG9naW5Vcmw6ICcvbG9naW4vJ1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgJGdldDogLT5cclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBnZXRTeXN0ZW1MYWJlbDogLT4gY29uZmlnLnN5c3RlbUxhYmVsXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0U2VydmVyQWRkcmVzczogLT4gY29uZmlnLnNlcnZlckFkZHJlc3NcclxuICAgICAgICAgICAgICAgICAgICBnZXRTZXJ2ZXJMb2dpblVybDogLT4gY29uZmlnLnNlcnZlckxvZ2luVXJsXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0U2VydmVyTG9nb3V0VXJsOiAtPiBjb25maWcuc2VydmVyTG9nb3V0VXJsXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0U2VydmVyVXNlckluZm9Vcmw6IC0+IGNvbmZpZy5zZXJ2ZXJVc2VySW5mb1VybFxyXG4gICAgICAgICAgICAgICAgICAgIGdldFNlcnZlckNTUkZVcmw6IC0+IGNvbmZpZy5zZXJ2ZXJDU1JGVXJsXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0QXBwTG9naW5Vcmw6IC0+IGNvbmZpZy5hcHBMb2dpblVybFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2V0U3lzdGVtTGFiZWw6IChsYWJlbCkgLT5cclxuICAgICAgICAgICAgICAgIGNvbmZpZy5zeXN0ZW1MYWJlbCA9IGxhYmVsXHJcblxyXG4gICAgICAgICAgICBzZXRTZXJ2ZXJBZGRyZXNzOiAoYWRkcmVzcykgLT5cclxuICAgICAgICAgICAgICAgIGNvbmZpZy5zZXJ2ZXJBZGRyZXNzID0gYWRkcmVzc1xyXG5cclxuICAgICAgICAgICAgc2V0U2VydmVyTG9naW5Vcmw6ICh1cmwpIC0+XHJcbiAgICAgICAgICAgICAgICBjb25maWcuc2VydmVyTG9naW5VcmwgPSB1cmxcclxuXHJcbiAgICAgICAgICAgIHNldFNlcnZlckxvZ291dFVybDogKHVybCkgLT5cclxuICAgICAgICAgICAgICAgIGNvbmZpZy5zZXJ2ZXJMb2dvdXRVcmwgPSB1cmxcclxuXHJcbiAgICAgICAgICAgIHNldFNlcnZlclVzZXJJbmZvVXJsOiAodXJsKSAtPlxyXG4gICAgICAgICAgICAgICAgY29uZmlnLnNlcnZlclVzZXJJbmZvVXJsID0gdXJsXHJcblxyXG4gICAgICAgICAgICBzZXRTZXJ2ZXJDU1JGVXJsOiAodXJsKSAtPlxyXG4gICAgICAgICAgICAgICAgY29uZmlnLnNlcnZlckNTUkZVcmwgPSB1cmxcclxuXHJcbiAgICAgICAgICAgIHNldEFwcExvZ2luVXJsOiAodXJsKSAtPlxyXG4gICAgICAgICAgICAgICAgY29uZmlnLmFwcExvZ2luVXJsID0gdXJsXHJcbiAgICAgICAgfSIsImFuZ3VsYXIubW9kdWxlKCdzd0F1dGgnLCBbXG4gICAgJ25nQ29va2llcydcbiAgICAnbmdSb3V0ZSdcbl0pXG5cbiAgICAuY29uc3RhbnQoJ0FVVEhfVVBEQVRFX1VTRVInLCAnc3dfYXV0aF9zZXJ2aWNlX3VwZGF0ZV91c2VyJylcbiAgICAuY29uc3RhbnQoJ0FVVEhfU0VSVkVSX1JFSkVDVCcsICdzd19hdXRoX3NlcnZpY2Vfc2VydmVyXzQwMV9vcl80MDNfcmVqZWN0JylcblxuICAgIC5jb25maWcgKCRodHRwUHJvdmlkZXIpIC0+XG4gICAgICAgICRodHRwUHJvdmlkZXIucmVzcG9uc2VJbnRlcmNlcHRvcnMucHVzaCgnc2VjdXJpdHlJbnRlcmNlcHRvcicpXG5cbiAgICAjIGJyb2FkY2FzdCBvZiA0MDEgb3IgNDAzIGh0dHAgc3RhdHVzXG4gICAgLnByb3ZpZGVyICdzZWN1cml0eUludGVyY2VwdG9yJywgLT5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICRnZXQ6ICgkbG9jYXRpb24sICRxLCAkcm9vdFNjb3BlLCBBVVRIX1NFUlZFUl9SRUpFQ1QpIC0+XG4gICAgICAgICAgICAgICAgcmV0dXJuIChwcm9taXNlKSAtPlxuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnRoZW4gbnVsbCwgKHJlc3BvbnNlKSAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzID09IDQwMSBvciByZXNwb25zZS5zdGF0dXMgPT0gNDAzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0IEFVVEhfU0VSVkVSX1JFSkVDVCwgcmVzcG9uc2Uuc3RhdHVzLCByZXNwb25zZS5kYXRhXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVzcG9uc2UpXG4gICAgICAgIH1cblxuXG4gICAgLnJ1biAoJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBhdXRoLCBBVVRIX1VQREFURV9VU0VSLCBBVVRIX1NFUlZFUl9SRUpFQ1QpIC0+XG4gICAgICAgICMgc3Vic2NyaWJlIG9uIHVybCBjaGFuZ2luZ1xuICAgICAgICAkcm9vdFNjb3BlLiRvbiAnJHJvdXRlQ2hhbmdlU3RhcnQnLCAoc2NvcGUsIG5leHQsIGN1cnJlbnQpIC0+XG4gICAgICAgICAgICAjIHNhdmUgb3JpZ2luIHBhdGhcbiAgICAgICAgICAgIG5leHRQYXRoID0gJydcbiAgICAgICAgICAgIGlmIG5leHQ/LiQkcm91dGU/Lm9yaWdpbmFsUGF0aFxuICAgICAgICAgICAgICAgIG5leHRQYXRoID0gbmV4dC4kJHJvdXRlLm9yaWdpbmFsUGF0aFxuXG4gICAgICAgICAgICAjIHJlZGlyZWN0IG5vdCBhdXRob3JpemVkIHVzZXIgdG8gbG9naW4gcGFnZVxuICAgICAgICAgICAgaWYgbm90IGF1dGguaXNBdXRoZW50aWNhdGVkKClcbiAgICAgICAgICAgICAgICBsb2dpblVybCA9IGF1dGguZ2V0TG9naW5VcmwoKVxuXG4gICAgICAgICAgICAgICAgIyBza2lwIHJlZGlyZWN0aW9uIGlmIHdlIGFyZSBnb2luZyB0byBsb2dpbiBwYWdlXG4gICAgICAgICAgICAgICAgaWYgbG9naW5VcmwgPT0gbmV4dFBhdGhcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG5cbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChsb2dpblVybClcblxuICAgICAgICAjIHN1YnNjcmliZSBzZXJ2ZXIgcmVqZWN0aW5nXG4gICAgICAgICRyb290U2NvcGUuJG9uIEFVVEhfU0VSVkVSX1JFSkVDVCwgKGV2ZW50LCBzZXJ2ZXJfc3RhdHVzKSAtPlxuICAgICAgICAgICAgYXV0aC5jbGVhckN1cnJlbnRVc2VyKClcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKGF1dGguZ2V0TG9naW5VcmwoKSkiLCJhbmd1bGFyLm1vZHVsZSgnc3dBdXRoJylcbiAgICAuc2VydmljZSAnYXV0aCcsICgkaHR0cCwgJHJvb3RTY29wZSwgJGNvb2tpZVN0b3JlLCBhdXRoQ29uZmlnLCBBVVRIX1VQREFURV9VU0VSKSAtPlxuICAgICAgICBhdXRoID0gdGhpc1xuXG4gICAgICAgIGF1dGguZ2V0VXNlciA9IC0+XG4gICAgICAgICAgICByZXR1cm4gJGNvb2tpZVN0b3JlLmdldCgndXNlcicpXG5cbiAgICAgICAgYXV0aC5zZXRVc2VyID0gKG5ld1VzZXJEYXRhKSAtPlxuICAgICAgICAgICAgb2xkVXNlckRhdGEgPSBhdXRoLmdldFVzZXIoKVxuICAgICAgICAgICAgJGNvb2tpZVN0b3JlLnB1dCgndXNlcicsIG5ld1VzZXJEYXRhKVxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0IEFVVEhfVVBEQVRFX1VTRVIsIG5ld1VzZXJEYXRhLCBvbGRVc2VyRGF0YVxuXG4gICAgICAgIGF1dGguaXNBdXRoZW50aWNhdGVkID0gKHVzZXJEYXRhKS0+XG4gICAgICAgICAgICB1c2VyID0gdXNlckRhdGEgb3IgYXV0aC5nZXRVc2VyKClcbiAgICAgICAgICAgIHJldHVybiB1c2VyPy5pc0F1dGhlbnRpY2F0ZWQgb3IgZmFsc2VcblxuICAgICAgICBhdXRoLmdldE5hbWUgPSAodXNlckRhdGEpIC0+XG4gICAgICAgICAgICB1c2VyID0gdXNlckRhdGEgb3IgYXV0aC5nZXRVc2VyKClcbiAgICAgICAgICAgIHJldHVybiB1c2VyPy51c2VybmFtZVxuXG4gICAgICAgIGF1dGguZ2V0TG9naW5VcmwgPSAtPlxuICAgICAgICAgICAgcmV0dXJuIGF1dGhDb25maWcuZ2V0QXBwTG9naW5VcmwoKVxuXG4gICAgICAgIGF1dGguZ2V0Q1NSRiA9IC0+XG4gICAgICAgICAgICBjc3JmVXJsID0gYXV0aENvbmZpZy5nZXRTZXJ2ZXJDU1JGVXJsKClcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoY3NyZlVybCkudGhlbiAocmVzcG9uc2UpIC0+XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGFcblxuICAgICAgICBhdXRoLmxvZ2luID0gKHVzZXJuYW1lLCBwYXNzd29yZCwgbWFrZVBvc3RTdWJtaXQpIC0+XG4gICAgICAgICAgICBjc3JmUHJvbWlzZSA9IGF1dGguZ2V0Q1NSRigpXG5cbiAgICAgICAgICAgICMgYWZ0ZXIgZ2V0dGluZyBjc3JmIHRva2VuIG1ha2UgbG9naW4gcmVxdWVzdFxuICAgICAgICAgICAgbG9naW5Qcm9taXNlID0gY3NyZlByb21pc2UudGhlbiAoY3NyZikgLT5cbiAgICAgICAgICAgICAgICBsb2dpblVybCA9IGF1dGhDb25maWcuZ2V0U2VydmVyTG9naW5VcmwoKVxuICAgICAgICAgICAgICAgIGxvZ2luUHJvbWlzZSA9ICRodHRwKFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiXG4gICAgICAgICAgICAgICAgICAgIHVybDogbG9naW5VcmxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNzcmZtaWRkbGV3YXJldG9rZW46IGNzcmZcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICAgICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdHJ1ZVxuICAgICAgICAgICAgICAgIClcblxuICAgICAgICAgICAgIyBhZnRlciBsb2dpbiBnbyB0byB1c2VyIGluZm8gbWV0aG9kXG4gICAgICAgICAgICBsb2dpblByb21pc2UgPSBsb2dpblByb21pc2UudGhlbiAtPlxuICAgICAgICAgICAgICAgIHVzZXJQcm9taXNlID0gYXV0aC5nZXRDdXJyZW50VXNlcigpXG5cbiAgICAgICAgICAgICAgICAjIGRpcnR5IGhhY2sgLSBvbGQgc2Nob29sIHN1Ym1pdCBmb3Igc2F2aW5nIGxvZ2luL3BhdGggd2l0aCBzdGFuZGFyZCBicm93c2VyIHF1ZXN0aW9uXG4gICAgICAgICAgICAgICAgaWYgbWFrZVBvc3RTdWJtaXRcbiAgICAgICAgICAgICAgICAgICAgdXNlclByb21pc2UudGhlbiAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybSA9ICQoXCI8Zm9ybSBtZXRob2Q9J1BPU1QnIGFjdGlvbj0nI3sgbG9naW5VcmwgfSc+PGlucHV0IG5hbWU9J3VzZXJuYW1lJz48aW5wdXQgbmFtZT0ncGFzc3dvcmQnPjwvZm9ybT5cIilcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0uZmluZCgnW25hbWU9dXNlcm5hbWVdJykudmFsIHVzZXJuYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtLmZpbmQoJ1tuYW1lPXBhc3N3b3JkXScpLnZhbCBwYXNzd29yZFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5zdWJtaXQoKVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJQcm9taXNlXG5cbiAgICAgICAgICAgIHJldHVybiBsb2dpblByb21pc2VcblxuXG4gICAgICAgIGF1dGguZ2V0Q3VycmVudFVzZXIgPSAtPlxuICAgICAgICAgICAgdXNlclByb21pc2UgPSAkaHR0cChcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCJcbiAgICAgICAgICAgICAgICB1cmw6IGF1dGhDb25maWcuZ2V0U2VydmVyVXNlckluZm9VcmwoKVxuICAgICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdHJ1ZVxuICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAjIGFkZCBzYXZlIHVzZXIgaW5mbyBtZXRob2QgY2FsbFxuICAgICAgICAgICAgdXNlclByb21pc2UgPSB1c2VyUHJvbWlzZS50aGVuIChyZXNwb25zZSkgLT5cbiAgICAgICAgICAgICAgICBuZXdVc2VyRGF0YSA9IHJlc3BvbnNlLmRhdGFcbiAgICAgICAgICAgICAgICBhdXRoLnNldFVzZXIobmV3VXNlckRhdGEpXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ld1VzZXJEYXRhXG5cbiAgICAgICAgICAgIHJldHVybiB1c2VyUHJvbWlzZVxuXG5cbiAgICAgICAgYXV0aC5jbGVhckN1cnJlbnRVc2VyID0gLT5cbiAgICAgICAgICAgIG5ld1VzZXJEYXRhID0ge31cbiAgICAgICAgICAgIGF1dGguc2V0VXNlcihuZXdVc2VyRGF0YSlcblxuICAgICAgICBhdXRoLmxvZ291dCA9IC0+XG4gICAgICAgICAgICBsb2dvdXRQcm9taXNlID0gJGh0dHAoXG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIlxuICAgICAgICAgICAgICAgIHVybDogYXV0aENvbmZpZy5nZXRTZXJ2ZXJMb2dvdXRVcmwoKVxuICAgICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdHJ1ZVxuICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICBsb2dvdXRQcm9taXNlLnRoZW4gLT5cbiAgICAgICAgICAgICAgICBhdXRoLmNsZWFyQ3VycmVudFVzZXIoKVxuXG4gICAgICAgICAgICByZXR1cm4gbG9nb3V0UHJvbWlzZVxuXG4gICAgICAgIHJldHVybiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==